"use strict";

require("core-js/modules/es.object.to-string.js");

require("core-js/modules/es.function.name.js");

require("core-js/modules/es.regexp.exec.js");

var _sliceInstanceProperty2 = require("@babel/runtime-corejs3/core-js-stable/instance/slice");

var _Array$from = require("@babel/runtime-corejs3/core-js-stable/array/from");

var _Symbol = require("@babel/runtime-corejs3/core-js-stable/symbol");

var _getIteratorMethod = require("@babel/runtime-corejs3/core-js/get-iterator-method");

var _Array$isArray = require("@babel/runtime-corejs3/core-js-stable/array/is-array");

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.parseStatus = exports.parseDispense = exports.isValidResponse = exports.formatMessage = void 0;

var _indexOf = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/index-of"));

var _slice = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/slice"));

var _helpers = require("../ECDM/helpers");

var _constants = require("./constants");

function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof _Symbol !== "undefined" && _getIteratorMethod(o) || o["@@iterator"]; if (!it) { if (_Array$isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { var _context; if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = _sliceInstanceProperty2(_context = Object.prototype.toString.call(o)).call(_context, 8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return _Array$from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var isValidResponse = function isValidResponse(response) {
  var indexOfStartOfText = (0, _indexOf.default)(response).call(response, _constants.STANDARD_BYTES.START_OF_TEXT);

  if (indexOfStartOfText !== 2) {
    return false;
  }

  var indexOfCRC = (0, _indexOf.default)(response).call(response, _constants.STANDARD_BYTES.END_OF_TEXT) + 1;

  if (indexOfCRC < 6) {
    return false;
  }

  return (0, _helpers.checkXorCrc)((0, _slice.default)(response).call(response, indexOfStartOfText, indexOfCRC + 1));
};

exports.isValidResponse = isValidResponse;

var formatMessage = function formatMessage(command) {
  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
  var message = [_constants.STANDARD_BYTES.START_OF_TRANSMISSION, _constants.STANDARD_BYTES.COMM_IDENTITY, _constants.STANDARD_BYTES.START_OF_TEXT];
  message.push(command);

  var _iterator = _createForOfIteratorHelper(data),
      _step;

  try {
    for (_iterator.s(); !(_step = _iterator.n()).done;) {
      var byte = _step.value;
      message.push(byte);
    }
  } catch (err) {
    _iterator.e(err);
  } finally {
    _iterator.f();
  }

  message.push(_constants.STANDARD_BYTES.END_OF_TEXT);
  var crc = (0, _helpers.calculateXorCrc)(message);
  message.push(crc);
  return message;
};

exports.formatMessage = formatMessage;

var parseDispense = function parseDispense(data) {
  var indexOfStart = (0, _indexOf.default)(data).call(data, _constants.STANDARD_BYTES.START_OF_HEADER);
  var indexOfCRC = (0, _indexOf.default)(data).call(data, _constants.STANDARD_BYTES.END_OF_TEXT) + 1;
  var response = (0, _slice.default)(data).call(data, indexOfStart, indexOfCRC + 1);
  var ok = !(response[4] - 0x20);
  var crc = (0, _helpers.checkXorCrc)(response);
  var errorCode = response[4];
  var errorText = _constants.STATUS_CODES.get(response[4]) || "";
  var cassettes = [{
    cassetteNumber: 1,
    requestedBillCHK: response[5] - 0x20,
    requestedBillEXIT: response[5] - 0x20,
    rejectedBill: response[6] - 0x20,
    cassetteStatus: "OK!"
  }];
  return {
    ok: ok,
    crc: crc,
    errorCode: errorCode,
    errorText: errorText,
    cassettes: cassettes
  };
};

exports.parseDispense = parseDispense;

var parseStatus = function parseStatus(data) {
  var indexOfStart = (0, _indexOf.default)(data).call(data, _constants.STANDARD_BYTES.START_OF_HEADER);
  var indexOfCRC = (0, _indexOf.default)(data).call(data, _constants.STANDARD_BYTES.END_OF_TEXT) + 1;
  var trimmedData = (0, _slice.default)(data).call(data, indexOfStart, indexOfCRC + 1);
  var data0 = trimmedData[4];
  var data1 = trimmedData[5];
  var AVERAGE_THICKNESS = trimmedData[6] - 0x20;
  var AVERAGE_LENGTH = trimmedData[7] - 0x20;
  var FEED_SENSOR_BLOCKED = Boolean(_constants.STATUS_BIT_SHIFT.FEED_SENSOR_BLOCKED && data0);
  var EXIT_SENSOR_BLOCKED = Boolean(_constants.STATUS_BIT_SHIFT.EXIT_SENSOR_BLOCKED && data0);
  var RESET_SINCE_LAST_STATUS_MESSAGE = Boolean(_constants.STATUS_BIT_SHIFT.RESET_SINCE_LAST_STATUS_MESSAGE && data0);
  var TIMING_WHEEL_SENSOR_BLOCKED = Boolean(_constants.STATUS_BIT_SHIFT.TIMING_WHEEL_SENSOR_BLOCKED && data0);
  var CALIBRATING_DOUBLE_DETECT = Boolean(_constants.STATUS_BIT_SHIFT.CALIBRATING_DOUBLE_DETECT && data1);
  return {
    FEED_SENSOR_BLOCKED: FEED_SENSOR_BLOCKED,
    EXIT_SENSOR_BLOCKED: EXIT_SENSOR_BLOCKED,
    RESET_SINCE_LAST_STATUS_MESSAGE: RESET_SINCE_LAST_STATUS_MESSAGE,
    TIMING_WHEEL_SENSOR_BLOCKED: TIMING_WHEEL_SENSOR_BLOCKED,
    CALIBRATING_DOUBLE_DETECT: CALIBRATING_DOUBLE_DETECT,
    AVERAGE_THICKNESS: AVERAGE_THICKNESS,
    AVERAGE_LENGTH: AVERAGE_LENGTH
  };
};

exports.parseStatus = parseStatus;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kZXZpY2VzL2Rpc3BlbnNlci9NSU5JTUVDSC9oZWxwZXJzLnRzIl0sIm5hbWVzIjpbImlzVmFsaWRSZXNwb25zZSIsInJlc3BvbnNlIiwiaW5kZXhPZlN0YXJ0T2ZUZXh0IiwiU1RBTkRBUkRfQllURVMiLCJTVEFSVF9PRl9URVhUIiwiaW5kZXhPZkNSQyIsIkVORF9PRl9URVhUIiwiZm9ybWF0TWVzc2FnZSIsImNvbW1hbmQiLCJkYXRhIiwibWVzc2FnZSIsIlNUQVJUX09GX1RSQU5TTUlTU0lPTiIsIkNPTU1fSURFTlRJVFkiLCJwdXNoIiwiYnl0ZSIsImNyYyIsInBhcnNlRGlzcGVuc2UiLCJpbmRleE9mU3RhcnQiLCJTVEFSVF9PRl9IRUFERVIiLCJvayIsImVycm9yQ29kZSIsImVycm9yVGV4dCIsIlNUQVRVU19DT0RFUyIsImdldCIsImNhc3NldHRlcyIsImNhc3NldHRlTnVtYmVyIiwicmVxdWVzdGVkQmlsbENISyIsInJlcXVlc3RlZEJpbGxFWElUIiwicmVqZWN0ZWRCaWxsIiwiY2Fzc2V0dGVTdGF0dXMiLCJwYXJzZVN0YXR1cyIsInRyaW1tZWREYXRhIiwiZGF0YTAiLCJkYXRhMSIsIkFWRVJBR0VfVEhJQ0tORVNTIiwiQVZFUkFHRV9MRU5HVEgiLCJGRUVEX1NFTlNPUl9CTE9DS0VEIiwiQm9vbGVhbiIsIlNUQVRVU19CSVRfU0hJRlQiLCJFWElUX1NFTlNPUl9CTE9DS0VEIiwiUkVTRVRfU0lOQ0VfTEFTVF9TVEFUVVNfTUVTU0FHRSIsIlRJTUlOR19XSEVFTF9TRU5TT1JfQkxPQ0tFRCIsIkNBTElCUkFUSU5HX0RPVUJMRV9ERVRFQ1QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7Ozs7Ozs7O0FBR08sSUFBTUEsZUFBZSxHQUFHLFNBQWxCQSxlQUFrQixDQUFDQyxRQUFELEVBQXNDO0FBQ25FLE1BQU1DLGtCQUFrQixHQUFHLHNCQUFBRCxRQUFRLE1B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LElBQUFBLG1CQUFtQixFQUFuQkEsbUJBRks7QUFHTEMsSUFBQUEsK0JBQStCLEVBQS9CQSwrQkFISztBQUlMQyxJQUFBQSwyQkFBMkIsRUFBM0JBLDJCQUpLO0FBS0xDLElBQUFBLHlCQUF5QixFQUF6QkEseUJBTEs7QUFNTFIsSUFBQUEsaUJBQWlCLEVBQWpCQSxpQkFOSztBQU9MQyxJQUFBQSxjQUFjLEVBQWRBO0FBUEssR0FBUDtBQVVELENBekJNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2FsY3VsYXRlWG9yQ3JjLCBjaGVja1hvckNyYyB9IGZyb20gXCIuLi9FQ0RNL2hlbHBlcnNcIjtcbmltcG9ydCB7IFNUQU5EQVJEX0JZVEVTLCBDT01NQU5EX0NPREVTLCBNSU5JTUVDSFN0YXR1cywgU1RBVFVTX0NPREVTLCBTVEFUVVNfQklUX1NISUZUIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBJRGlzcGVuc2VBbnN3ZXIgfSBmcm9tIFwiLi4vLi4vbW9kZWwvSURpc3BlbnNlclwiO1xuXG5leHBvcnQgY29uc3QgaXNWYWxpZFJlc3BvbnNlID0gKHJlc3BvbnNlOiBBcnJheTxudW1iZXI+KTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IGluZGV4T2ZTdGFydE9mVGV4dCA9IHJlc3BvbnNlLmluZGV4T2YoU1RBTkRBUkRfQllURVMuU1RBUlRfT0ZfVEVYVCk7XG4gIGlmIChpbmRleE9mU3RhcnRPZlRleHQgIT09IDIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBpbmRleE9mQ1JDOiBudW1iZXIgPSByZXNwb25zZS5pbmRleE9mKFNUQU5EQVJEX0JZVEVTLkVORF9PRl9URVhUKSArIDE7XG5cbiAgaWYgKGluZGV4T2ZDUkMgPCA2KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGNoZWNrWG9yQ3JjKHJlc3BvbnNlLnNsaWNlKGluZGV4T2ZTdGFydE9mVGV4dCwgaW5kZXhPZkNSQyArIDEpKTtcbn1cblxuZXhwb3J0IGNvbnN0IGZvcm1hdE1lc3NhZ2UgPSAoY29tbWFuZDogQ09NTUFORF9DT0RFUywgZGF0YTogQXJyYXk8bnVtYmVyPiA9IFtdKTogQXJyYXk8bnVtYmVyPiA9PiB7XG4gIGNvbnN0IG1lc3NhZ2U6IEFycmF5PG51bWJlcj4gPSBbU1RBTkRBUkRfQllURVMuU1RBUlRfT0ZfVFJBTlNNSVNTSU9OLCBTVEFOREFSRF9CWVRFUy5DT01NX0lERU5USVRZLCBTVEFOREFSRF9CWVRFUy5TVEFSVF9PRl9URVhUXTtcbiAgbWVzc2FnZS5wdXNoKGNvbW1hbmQpO1xuICBmb3IgKGNvbnN0IGJ5dGUgb2YgZGF0YSkge1xuICAgIG1lc3NhZ2UucHVzaChieXRlKTtcbiAgfVxuICBtZXNzYWdlLnB1c2goU1RBTkRBUkRfQllURVMuRU5EX09GX1RFWFQpO1xuICBjb25zdCBjcmMgPSBjYWxjdWxhdGVYb3JDcmMobWVzc2FnZSk7XG4gIG1lc3NhZ2UucHVzaChjcmMpO1xuICByZXR1cm4gbWVzc2FnZTtcbn1cblxuZXhwb3J0IGNvbnN0IHBhcnNlRGlzcGVuc2UgPSAoZGF0YTogQXJyYXk8bnVtYmVyPik6IElEaXNwZW5zZUFuc3dlciA9PiB7XG4gIGNvbnN0IGluZGV4T2ZTdGFydDogbnVtYmVyID0gZGF0YS5pbmRleE9mKFNUQU5EQVJEX0JZVEVTLlNUQVJUX09GX0hFQURFUik7XG4gIGNvbnN0IGluZGV4T2ZDUkM6IG51bWJlciA9IGRhdGEuaW5kZXhPZihTVEFOREFSRF9CWVRFUy5FTkRfT0ZfVEVYVCkgKyAxO1xuICBjb25zdCByZXNwb25zZSA9IGRhdGEuc2xpY2UoaW5kZXhPZlN0YXJ0LCBpbmRleE9mQ1JDICsgMSk7XG4gIGNvbnN0IG9rOiBib29sZWFuID0gIShyZXNwb25zZVs0XSAtIDB4MjApO1xuICBjb25zdCBjcmM6IGJvb2xlYW4gPSBjaGVja1hvckNyYyhyZXNwb25zZSk7XG4gIGNvbnN0IGVycm9yQ29kZTogbnVtYmVyID0gcmVzcG9uc2VbNF07XG4gIGNvbnN0IGVycm9yVGV4dDogc3RyaW5nID0gU1RBVFVTX0NPREVTLmdldChyZXNwb25zZVs0XSkgfHwgXCJcIjtcbiAgY29uc3QgY2Fzc2V0dGVzID0gW3tcbiAgICBjYXNzZXR0ZU51bWJlcjogMSxcbiAgICByZXF1ZXN0ZWRCaWxsQ0hLOiByZXNwb25zZVs1XSAtIDB4MjAsXG4gICAgcmVxdWVzdGVkQmlsbEVYSVQ6IHJlc3BvbnNlWzVdIC0gMHgyMCxcbiAgICByZWplY3RlZEJpbGw6IHJlc3BvbnNlWzZdIC0gMHgyMCxcbiAgICBjYXNzZXR0ZVN0YXR1czogXCJPSyFcIlxuICB9XTtcblxuICByZXR1cm4ge1xuICAgIG9rLFxuICAgIGNyYyxcbiAgICBlcnJvckNvZGUsXG4gICAgZXJyb3JUZXh0LFxuICAgIGNhc3NldHRlc1xuICB9O1xufVxuXG5leHBvcnQgY29uc3QgcGFyc2VTdGF0dXMgPSAoZGF0YTogQXJyYXk8bnVtYmVyPik6IE1JTklNRUNIU3RhdHVzID0+IHtcbiAgY29uc3QgaW5kZXhPZlN0YXJ0OiBudW1iZXIgPSBkYXRhLmluZGV4T2YoU1RBTkRBUkRfQllURVMuU1RBUlRfT0ZfSEVBREVSKTtcbiAgY29uc3QgaW5kZXhPZkNSQzogbnVtYmVyID0gZGF0YS5pbmRleE9mKFNUQU5EQVJEX0JZVEVTLkVORF9PRl9URVhUKSArIDE7XG4gIGNvbnN0IHRyaW1tZWREYXRhID0gZGF0YS5zbGljZShpbmRleE9mU3RhcnQsIGluZGV4T2ZDUkMgKyAxKTtcbiAgY29uc3QgZGF0YTAgPSB0cmltbWVkRGF0YVs0XTtcbiAgY29uc3QgZGF0YTEgPSB0cmltbWVkRGF0YVs1XTtcbiAgY29uc3QgQVZFUkFHRV9USElDS05FU1M6IG51bWJlciA9IHRyaW1tZWREYXRhWzZdIC0gMHgyMDtcbiAgY29uc3QgQVZFUkFHRV9MRU5HVEg6IG51bWJlciA9IHRyaW1tZWREYXRhWzddIC0gMHgyMDtcblxuICBjb25zdCBGRUVEX1NFTlNPUl9CTE9DS0VEOiBib29sZWFuID0gQm9vbGVhbihTVEFUVVNfQklUX1NISUZULkZFRURfU0VOU09SX0JMT0NLRUQgJiYgZGF0YTApO1xuICBjb25zdCBFWElUX1NFTlNPUl9CTE9DS0VEOiBib29sZWFuID0gQm9vbGVhbihTVEFUVVNfQklUX1NISUZULkVYSVRfU0VOU09SX0JMT0NLRUQgJiYgZGF0YTApO1xuICBjb25zdCBSRVNFVF9TSU5DRV9MQVNUX1NUQVRVU19NRVNTQUdFOiBib29sZWFuID0gQm9vbGVhbihTVEFUVVNfQklUX1NISUZULlJFU0VUX1NJTkNFX0xBU1RfU1RBVFVTX01FU1NBR0UgJiYgZGF0YTApO1xuICBjb25zdCBUSU1JTkdfV0hFRUxfU0VOU09SX0JMT0NLRUQ6IGJvb2xlYW4gPSBCb29sZWFuKFNUQVRVU19CSVRfU0hJRlQuVElNSU5HX1dIRUVMX1NFTlNPUl9CTE9DS0VEICYmIGRhdGEwKTtcbiAgY29uc3QgQ0FMSUJSQVRJTkdfRE9VQkxFX0RFVEVDVDogYm9vbGVhbiA9IEJvb2xlYW4oU1RBVFVTX0JJVF9TSElGVC5DQUxJQlJBVElOR19ET1VCTEVfREVURUNUICYmIGRhdGExKTtcblxuICByZXR1cm4ge1xuICAgIEZFRURfU0VOU09SX0JMT0NLRUQsXG4gICAgRVhJVF9TRU5TT1JfQkxPQ0tFRCxcbiAgICBSRVNFVF9TSU5DRV9MQVNUX1NUQVRVU19NRVNTQUdFLFxuICAgIFRJTUlOR19XSEVFTF9TRU5TT1JfQkxPQ0tFRCxcbiAgICBDQUxJQlJBVElOR19ET1VCTEVfREVURUNULFxuICAgIEFWRVJBR0VfVEhJQ0tORVNTLFxuICAgIEFWRVJBR0VfTEVOR1RIXG4gIH07XG5cbn0iXX0=